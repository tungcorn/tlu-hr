// =============================================================================
// HRMS Database Schema - Truong Dai hoc Thuy loi (TLU)
// Human Resource Management System
// Version: 1.0
// Date: 2026-01-23
// =============================================================================
// Generated for dbdiagram.io - https://dbdiagram.io
// =============================================================================

Project HRMS_TLU {
  database_type: 'PostgreSQL'
  Note: '''
    # He thong Quan ly Nhan su - Truong Dai hoc Thuy loi
    
    ## Modules:
    - Employee Records (FR-ER)
    - Qualifications (FR-QM)
    - Organization Structure (FR-OS)
    - Contract Management (FR-CM)
    - Time & Attendance (FR-TA)
    - Payroll & Benefits (FR-PB)
    - Recruitment (FR-RC)
    - Performance & Rewards (FR-PR)
    - Training & Development (FR-TD)
    - Research Management (FR-RM)
    - Teaching Load (FR-TL)
    - System Configuration (FR-CF)
  '''
}

// =============================================================================
// SECTION 1: SYSTEM CONFIGURATION (FR-CF)
// Configurable parameters for salary, allowances, contracts, etc.
// =============================================================================

Table cfg_base_salary {
  id int [pk, increment]
  amount decimal(15,2) [not null, note: 'Muc luong co so (VND)']
  effective_date date [not null, note: 'Ngay hieu luc']
  end_date date [note: 'Ngay ket thuc (null = hien hanh)']
  legal_document varchar(100) [note: 'So hieu van ban phap ly']
  created_at timestamp [default: `now()`]
  created_by int
  
  Note: 'FR-CF-001: Muc luong co so theo thoi ky'
}

Table cfg_salary_rank {
  id int [pk, increment]
  rank_code varchar(20) [not null, unique, note: 'Ma ngach (V.07.01.01, V.07.01.02...)']
  rank_name varchar(100) [not null, note: 'Ten ngach (Giang vien cao cap, GV chinh, GV)']
  rank_group varchar(50) [note: 'Nhom ngach (Giang vien, Chuyen vien...)']
  min_grade int [default: 1]
  max_grade int [not null]
  effective_date date [not null]
  end_date date
  is_active boolean [default: true]
  
  Note: 'FR-CF-002: Danh muc ngach luong'
}

Table cfg_salary_coefficient {
  id int [pk, increment]
  rank_id int [ref: > cfg_salary_rank.id, not null]
  grade int [not null, note: 'Bac luong (1, 2, 3...)']
  coefficient decimal(4,2) [not null, note: 'He so luong']
  effective_date date [not null]
  end_date date
  
  indexes {
    (rank_id, grade, effective_date) [unique]
  }
  
  Note: 'FR-CF-004: He so luong theo ngach/bac'
}

Table cfg_allowance_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null, note: 'Ten loai phu cap']
  formula_type varchar(50) [not null, note: 'coefficient_base, percent_salary, fixed_amount']
  description text
  is_taxable boolean [default: true]
  is_active boolean [default: true]
  
  Note: 'FR-CF-006: Danh muc loai phu cap'
}

Table cfg_position_allowance {
  id int [pk, increment]
  position_id int [ref: > cfg_position.id, not null]
  coefficient decimal(4,2) [not null, note: 'He so phu cap chuc vu']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-008: Phu cap chuc vu theo vi tri'
}

Table cfg_seniority_allowance {
  id int [pk, increment]
  min_years int [not null, note: 'So nam toi thieu']
  base_rate decimal(5,2) [not null, note: 'Ty le % khoi diem']
  increment_rate decimal(5,2) [not null, note: 'Ty le tang them moi nam']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-009: Quy tac phu cap tham nien'
}

Table cfg_contract_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  min_duration_months int [note: 'Thoi han toi thieu (thang)']
  max_duration_months int [note: 'Thoi han toi da (thang)']
  max_renewals int [note: 'So lan gia han toi da']
  is_indefinite boolean [default: false]
  is_active boolean [default: true]
  
  Note: 'FR-CF-012, FR-CF-013, FR-CF-014: Loai hop dong'
}

Table cfg_probation_period {
  id int [pk, increment]
  position_level varchar(50) [not null, note: 'Cap do vi tri']
  duration_days int [not null]
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-015: Thoi gian thu viec theo vi tri'
}

Table cfg_insurance_rate {
  id int [pk, increment]
  insurance_type varchar(20) [not null, note: 'BHXH, BHYT, BHTN']
  employee_rate decimal(5,2) [not null, note: 'Ty le nguoi lao dong dong']
  employer_rate decimal(5,2) [not null, note: 'Ty le nguoi su dung dong']
  ceiling_amount decimal(15,2) [note: 'Muc tran dong bao hiem']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-017, FR-CF-018, FR-CF-019: Ty le bao hiem'
}

Table cfg_tax_bracket {
  id int [pk, increment]
  bracket_order int [not null]
  min_income decimal(15,2) [not null]
  max_income decimal(15,2) [note: 'null = khong gioi han']
  tax_rate decimal(5,2) [not null, note: 'Thue suat %']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-020: Bang thue TNCN luy tien'
}

Table cfg_tax_deduction {
  id int [pk, increment]
  deduction_type varchar(50) [not null, note: 'personal, dependent']
  amount decimal(15,2) [not null]
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-021: Muc giam tru gia canh'
}

Table cfg_leave_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  max_days_per_year int
  is_paid boolean [default: true]
  requires_approval boolean [default: true]
  requires_document boolean [default: false]
  is_active boolean [default: true]
  
  Note: 'FR-CF-023: Danh muc loai nghi phep'
}

Table cfg_annual_leave {
  id int [pk, increment]
  base_days int [not null, note: 'So ngay phep co ban']
  seniority_years int [not null, note: 'Moi X nam']
  bonus_days int [not null, note: 'Cong them Y ngay']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-022: Quy tac phep nam theo tham nien'
}

Table cfg_overtime_rate {
  id int [pk, increment]
  day_type varchar(20) [not null, note: 'normal, weekend, holiday']
  rate_multiplier decimal(4,2) [not null, note: 'He so luong lam them']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-026: He so luong lam them gio'
}

Table cfg_teaching_quota {
  id int [pk, increment]
  rank_id int [ref: > cfg_salary_rank.id]
  academic_title_id int [ref: > cfg_academic_title.id]
  standard_hours int [not null, note: 'Dinh muc gio giang chuan']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-027: Dinh muc gio giang theo chuc danh'
}

Table cfg_teaching_conversion {
  id int [pk, increment]
  activity_type varchar(50) [not null, note: 'theory, practice, thesis_guidance, exam...']
  conversion_rate decimal(4,2) [not null, note: 'He so quy doi ra gio chuan']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-028: He so quy doi gio giang'
}

Table cfg_overtime_teaching_rate {
  id int [pk, increment]
  rank_id int [ref: > cfg_salary_rank.id]
  rate_per_hour decimal(15,2) [not null, note: 'Don gia gio vuot']
  effective_date date [not null]
  end_date date
  
  Note: 'FR-CF-029: Don gia gio giang vuot dinh muc'
}

Table cfg_position {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  level int [note: 'Cap bac (1=Hieu truong, 2=Pho HT...)']
  is_leadership boolean [default: false]
  is_active boolean [default: true]
  
  Note: 'Danh muc chuc vu'
}

Table cfg_academic_title {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  abbreviation varchar(20) [note: 'GS, PGS']
  display_order int
  is_active boolean [default: true]
  
  Note: 'Danh muc hoc ham (Giao su, Pho Giao su)'
}

Table cfg_degree_level {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  abbreviation varchar(20) [note: 'TS, ThS, CN']
  display_order int
  is_active boolean [default: true]
  
  Note: 'Danh muc trinh do hoc van'
}

// =============================================================================
// SECTION 2: ORGANIZATION STRUCTURE (FR-OS)
// =============================================================================

Table campus {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(200) [not null]
  address text
  phone varchar(50)
  email varchar(100)
  is_main boolean [default: false]
  is_active boolean [default: true]
  established_date date
  
  Note: 'FR-OS-007: Co so/Phan hieu'
}

Table organization_unit_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null, note: 'Khoa, Vien, Trung tam, Phong, Bo mon, PTN']
  level int [note: 'Cap bac trong cau truc']
  is_active boolean [default: true]
  
  Note: 'FR-OS-001: Loai don vi'
}

Table organization_unit {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(200) [not null]
  name_en varchar(200)
  unit_type_id int [ref: > organization_unit_type.id, not null]
  parent_id int [ref: > organization_unit.id, note: 'Don vi cap tren']
  campus_id int [ref: > campus.id]
  parallel_unit_id int [ref: > organization_unit.id, note: 'Don vi song song (Khoa-Vien)']
  address text
  phone varchar(50)
  email varchar(100)
  website varchar(200)
  established_date date
  dissolved_date date
  is_active boolean [default: true]
  
  Note: 'FR-OS-002, FR-OS-003, FR-OS-004, FR-OS-005: Don vi to chuc'
}

Table organization_unit_history {
  id int [pk, increment]
  unit_id int [ref: > organization_unit.id, not null]
  event_type varchar(50) [not null, note: 'established, merged, split, renamed, dissolved']
  event_date date [not null]
  description text
  related_unit_id int [ref: > organization_unit.id]
  created_at timestamp [default: `now()`]
  
  Note: 'FR-OS-005: Lich su don vi'
}

Table laboratory {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(200) [not null]
  unit_id int [ref: > organization_unit.id, not null]
  location text
  equipment_description text
  is_active boolean [default: true]
  
  Note: 'FR-OS-010: Phong thi nghiem'
}

Table training_program {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(200) [not null]
  level varchar(50) [not null, note: 'undergraduate, master, doctoral']
  unit_id int [ref: > organization_unit.id, not null]
  is_active boolean [default: true]
  
  Note: 'FR-OS-013: Nganh dao tao gan voi don vi'
}

// =============================================================================
// SECTION 3: EMPLOYEE RECORDS (FR-ER)
// =============================================================================

Table employee_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  description text
  is_active boolean [default: true]
  
  Note: 'Loai nhan su: GV co huu, GV thinh giang, CB quan ly, NV hanh chinh...'
}

Table employee {
  id int [pk, increment]
  employee_code varchar(20) [not null, unique, note: 'Ma can bo (FR-ER-009)']
  employee_type_id int [ref: > employee_type.id, not null]
  
  // Personal info (FR-ER-001)
  first_name varchar(50) [not null]
  last_name varchar(50) [not null]
  full_name varchar(100) [not null]
  date_of_birth date [not null]
  gender varchar(10) [not null]
  id_number varchar(20) [unique, note: 'CCCD/CMT']
  id_issue_date date
  id_issue_place varchar(200)
  place_of_birth varchar(200)
  hometown varchar(200) [note: 'Que quan']
  ethnicity varchar(50) [note: 'Dan toc']
  religion varchar(50) [note: 'Ton giao']
  nationality varchar(50) [default: 'Viet Nam']
  
  // Contact info (FR-ER-002)
  permanent_address text
  temporary_address text
  phone varchar(20)
  personal_email varchar(100)
  work_email varchar(100)
  
  // Bank info (FR-ER-005)
  bank_name varchar(100)
  bank_account varchar(50)
  bank_branch varchar(200)
  
  // Party membership (FR-ER-007)
  is_party_member boolean [default: false]
  party_join_date date
  party_official_date date
  party_cell varchar(200) [note: 'Dang bo truc thuoc']
  
  // Union membership (FR-ER-008)
  is_union_member boolean [default: false]
  union_join_date date
  
  // Lecturer extended info (FR-ER-013, FR-ER-014)
  research_areas text [note: 'Linh vuc nghien cuu']
  research_keywords text [note: 'Tu khoa chuyen mon']
  profile_url varchar(500) [note: 'Trang ca nhan']
  
  // For visiting lecturers (FR-ER-018)
  primary_workplace varchar(200) [note: 'Don vi cong tac chinh (GV thinh giang)']
  
  // Photo (FR-ER-004)
  photo_3x4 varchar(500)
  photo_4x6 varchar(500)
  
  // Status
  hire_date date [not null]
  termination_date date
  status varchar(20) [default: 'active', note: 'active, on_leave, terminated']
  
  created_at timestamp [default: `now()`]
  updated_at timestamp
  
  Note: 'FR-ER-001 to FR-ER-018: Ho so nhan su'
}

Table employee_marital_status {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  status varchar(20) [not null, note: 'single, married, divorced, widowed']
  effective_date date [not null]
  spouse_name varchar(100)
  spouse_dob date
  spouse_occupation varchar(100)
  spouse_workplace varchar(200)
  
  Note: 'FR-ER-003: Tinh trang hon nhan'
}

Table employee_dependent {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  full_name varchar(100) [not null]
  relationship varchar(50) [not null, note: 'spouse, child, parent']
  date_of_birth date
  id_number varchar(20)
  tax_code varchar(20)
  is_tax_dependent boolean [default: true, note: 'Nguoi phu thuoc tinh thue TNCN']
  effective_from date
  effective_to date
  
  Note: 'FR-ER-003: Nguoi phu thuoc (giam tru thue TNCN)'
}

Table employee_work_history {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  organization varchar(200) [not null]
  position varchar(100)
  start_date date [not null]
  end_date date
  description text
  is_before_tlu boolean [default: true, note: 'Truoc khi vao truong']
  
  Note: 'FR-ER-006: Qua trinh cong tac'
}

Table employee_unit_assignment {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  unit_id int [ref: > organization_unit.id, not null]
  position_id int [ref: > cfg_position.id]
  assignment_type varchar(20) [not null, note: 'primary, concurrent, secondment']
  start_date date [not null]
  end_date date
  decision_number varchar(50)
  decision_date date
  is_current boolean [default: true]
  
  indexes {
    (employee_id, unit_id, assignment_type, start_date) [unique]
  }
  
  Note: 'FR-ER-015, FR-ER-016, FR-OS-008, FR-OS-009: Phan cong don vi va chuc vu'
}

Table employee_audit_log {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  field_name varchar(100) [not null]
  old_value text
  new_value text
  changed_at timestamp [default: `now()`]
  changed_by int [ref: > employee.id]
  
  Note: 'FR-ER-012: Lich su thay doi ho so'
}

// =============================================================================
// SECTION 4: QUALIFICATIONS MANAGEMENT (FR-QM)
// =============================================================================

Table institution {
  id int [pk, increment]
  name varchar(200) [not null]
  country varchar(100) [not null]
  is_domestic boolean [default: true]
  is_active boolean [default: true]
  
  Note: 'FR-QM-012: Noi dao tao'
}

Table employee_degree {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  degree_level_id int [ref: > cfg_degree_level.id, not null]
  degree_name varchar(200) [not null]
  major varchar(200) [not null]
  institution_id int [ref: > institution.id]
  institution_name varchar(200) [note: 'Neu khong co trong danh muc']
  graduation_year int
  graduation_date date
  classification varchar(50) [note: 'Xuat sac, Gioi, Kha, TB']
  certificate_number varchar(100)
  is_highest boolean [default: false]
  
  Note: 'FR-QM-001, FR-QM-002: Bang cap'
}

Table employee_academic_title {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  academic_title_id int [ref: > cfg_academic_title.id, not null]
  conferment_date date [not null]
  conferment_year int [not null]
  decision_number varchar(100)
  is_current boolean [default: true]
  
  Note: 'FR-QM-003: Hoc ham (GS, PGS)'
}

Table employee_lecturer_rank {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  rank_id int [ref: > cfg_salary_rank.id, not null]
  grade int [not null]
  effective_date date [not null]
  end_date date
  decision_number varchar(100)
  decision_date date
  is_current boolean [default: true]
  
  Note: 'FR-QM-004: Hoc ham giang vien (GV, GVC, GVCC)'
}

Table certificate_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  category varchar(50) [note: 'language, it, pedagogy, other']
  has_expiry boolean [default: false]
  is_active boolean [default: true]
  
  Note: 'Loai chung chi'
}

Table employee_certificate {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  certificate_type_id int [ref: > certificate_type.id, not null]
  name varchar(200) [not null]
  issuing_organization varchar(200)
  issue_date date
  expiry_date date
  score varchar(50) [note: 'Diem so (IELTS 7.5, TOEFL 100...)']
  certificate_number varchar(100)
  
  Note: 'FR-QM-005, FR-QM-006: Chung chi'
}

Table employee_position_history {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  position_id int [ref: > cfg_position.id, not null]
  unit_id int [ref: > organization_unit.id, not null]
  appointment_type varchar(20) [not null, note: 'appointment, dismissal']
  effective_date date [not null]
  end_date date
  decision_number varchar(100)
  decision_date date
  
  Note: 'FR-QM-007, FR-QM-008: Lich su bo nhiem/mien nhiem chuc vu'
}

Table teacher_title {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  is_active boolean [default: true]
  
  Note: 'Danh hieu nha giao (NGUT, NGND)'
}

Table employee_teacher_title {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  title_id int [ref: > teacher_title.id, not null]
  conferment_year int [not null]
  decision_number varchar(100)
  
  Note: 'FR-QM-011: Danh hieu nha giao'
}

// =============================================================================
// SECTION 5: CONTRACT MANAGEMENT (FR-CM)
// =============================================================================

Table contract {
  id int [pk, increment]
  contract_number varchar(50) [not null, unique]
  employee_id int [ref: > employee.id, not null]
  contract_type_id int [ref: > cfg_contract_type.id, not null]
  
  signing_date date [not null]
  effective_date date [not null]
  expiry_date date [note: 'null = vo thoi han']
  
  job_title varchar(200)
  job_description text
  work_location varchar(200)
  
  base_salary_config_id int [ref: > cfg_base_salary.id]
  rank_id int [ref: > cfg_salary_rank.id]
  grade int
  
  probation_end_date date
  is_probation_passed boolean
  
  status varchar(20) [default: 'active', note: 'active, expired, terminated, superseded']
  
  previous_contract_id int [ref: > contract.id, note: 'Hop dong truoc do']
  renewal_count int [default: 0]
  
  created_at timestamp [default: `now()`]
  created_by int
  
  Note: 'FR-CM-001 to FR-CM-013: Hop dong lao dong'
}

Table contract_appendix {
  id int [pk, increment]
  contract_id int [ref: > contract.id, not null]
  appendix_number varchar(50) [not null]
  signing_date date [not null]
  effective_date date [not null]
  content text
  reason text
  
  // Changes
  new_rank_id int [ref: > cfg_salary_rank.id]
  new_grade int
  new_job_title varchar(200)
  new_salary_amount decimal(15,2)
  
  created_at timestamp [default: `now()`]
  created_by int
  
  Note: 'FR-CM-007: Phu luc hop dong'
}

Table contract_termination {
  id int [pk, increment]
  contract_id int [ref: > contract.id, not null, unique]
  termination_date date [not null]
  termination_type varchar(50) [not null, note: 'resignation, dismissal, retirement, expiry, mutual']
  reason text
  
  severance_pay decimal(15,2) [note: 'Tro cap thoi viec']
  remaining_leave_pay decimal(15,2)
  other_payments decimal(15,2)
  
  decision_number varchar(100)
  decision_date date
  
  created_at timestamp [default: `now()`]
  created_by int
  
  Note: 'FR-CM-004, FR-CM-010: Cham dut hop dong'
}

Table work_permit {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  permit_number varchar(100) [not null]
  issue_date date [not null]
  expiry_date date [not null]
  issuing_authority varchar(200)
  job_position varchar(200)
  work_location varchar(200)
  
  Note: 'FR-CM-009: Giay phep lao dong (nguoi nuoc ngoai)'
}

// =============================================================================
// SECTION 6: TIME & ATTENDANCE (FR-TA)
// =============================================================================

Table attendance_record {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  attendance_date date [not null]
  check_in_time timestamp
  check_out_time timestamp
  check_in_method varchar(20) [note: 'fingerprint, card, face, manual']
  check_out_method varchar(20)
  work_hours decimal(4,2)
  overtime_hours decimal(4,2)
  status varchar(20) [note: 'present, absent, late, early_leave, on_leave, business_trip']
  note text
  
  indexes {
    (employee_id, attendance_date) [unique]
  }
  
  Note: 'FR-TA-001, FR-TA-006: Cham cong'
}

Table leave_request {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  leave_type_id int [ref: > cfg_leave_type.id, not null]
  start_date date [not null]
  end_date date [not null]
  total_days decimal(4,1) [not null]
  reason text
  
  status varchar(20) [default: 'pending', note: 'pending, approved, rejected, cancelled']
  
  approved_by int [ref: > employee.id]
  approved_at timestamp
  rejection_reason text
  
  created_at timestamp [default: `now()`]
  
  Note: 'FR-TA-002, FR-TA-004: Don nghi phep'
}

Table leave_balance {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  leave_type_id int [ref: > cfg_leave_type.id, not null]
  year int [not null]
  entitled_days decimal(4,1) [not null]
  used_days decimal(4,1) [default: 0]
  carried_days decimal(4,1) [default: 0, note: 'Phep nam truoc chuyen sang']
  remaining_days decimal(4,1)
  
  indexes {
    (employee_id, leave_type_id, year) [unique]
  }
  
  Note: 'FR-TA-003: So ngay phep con lai'
}

Table overtime_request {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  request_date date [not null]
  start_time timestamp [not null]
  end_time timestamp [not null]
  hours decimal(4,2) [not null]
  day_type varchar(20) [not null, note: 'normal, weekend, holiday']
  reason text
  
  status varchar(20) [default: 'pending']
  approved_by int [ref: > employee.id]
  approved_at timestamp
  
  Note: 'FR-TA-007: Lam them gio'
}

Table business_trip {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  destination varchar(200) [not null]
  purpose text [not null]
  start_date date [not null]
  end_date date [not null]
  trip_type varchar(50) [note: 'domestic, international, conference, workshop']
  
  status varchar(20) [default: 'pending']
  approved_by int [ref: > employee.id]
  approved_at timestamp
  
  expenses decimal(15,2)
  expense_status varchar(20)
  
  Note: 'FR-TA-008: Cong tac'
}

// =============================================================================
// SECTION 7: PAYROLL & BENEFITS (FR-PB)
// =============================================================================

Table employee_salary {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  rank_id int [ref: > cfg_salary_rank.id, not null]
  grade int [not null]
  coefficient decimal(4,2) [not null]
  effective_date date [not null]
  end_date date
  decision_number varchar(100)
  decision_date date
  promotion_type varchar(50) [note: 'regular, early, appointed']
  is_current boolean [default: true]
  
  Note: 'FR-PB-001, FR-PB-005: Bac luong hien tai'
}

Table employee_allowance {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  allowance_type_id int [ref: > cfg_allowance_type.id, not null]
  amount decimal(15,2) [note: 'So tien co dinh (neu co)']
  coefficient decimal(4,2) [note: 'He so (neu ap dung)']
  percentage decimal(5,2) [note: 'Ty le % (neu ap dung)']
  effective_date date [not null]
  end_date date
  decision_number varchar(100)
  is_current boolean [default: true]
  
  Note: 'FR-PB-003, FR-PB-004: Phu cap'
}

Table payroll_period {
  id int [pk, increment]
  year int [not null]
  month int [not null]
  start_date date [not null]
  end_date date [not null]
  status varchar(20) [default: 'draft', note: 'draft, calculated, approved, paid, closed']
  calculated_at timestamp
  approved_at timestamp
  approved_by int [ref: > employee.id]
  paid_at timestamp
  
  indexes {
    (year, month) [unique]
  }
  
  Note: 'FR-PB-011: Ky tinh luong'
}

Table payroll {
  id int [pk, increment]
  payroll_period_id int [ref: > payroll_period.id, not null]
  employee_id int [ref: > employee.id, not null]
  
  // Salary components
  base_salary_amount decimal(15,2) [note: 'Muc luong co so ap dung']
  salary_coefficient decimal(4,2)
  gross_salary decimal(15,2) [note: 'Luong co ban = coefficient * base']
  
  // Allowances
  position_allowance decimal(15,2)
  seniority_allowance decimal(15,2)
  industry_allowance decimal(15,2) [note: 'Phu cap uu dai nganh']
  responsibility_allowance decimal(15,2)
  other_allowances decimal(15,2)
  total_allowances decimal(15,2)
  
  // Overtime & teaching
  overtime_hours decimal(6,2)
  overtime_pay decimal(15,2)
  teaching_hours_excess decimal(6,2) [note: 'Gio giang vuot']
  teaching_excess_pay decimal(15,2)
  
  // Bonuses
  bonus_amount decimal(15,2)
  
  // Deductions
  bhxh_employee decimal(15,2) [note: 'BHXH nguoi lao dong']
  bhyt_employee decimal(15,2)
  bhtn_employee decimal(15,2)
  total_insurance_employee decimal(15,2)
  
  taxable_income decimal(15,2)
  personal_deduction decimal(15,2)
  dependent_deduction decimal(15,2)
  pit_amount decimal(15,2) [note: 'Thue TNCN']
  
  advance_deduction decimal(15,2) [note: 'Tam ung']
  other_deductions decimal(15,2)
  total_deductions decimal(15,2)
  
  // Net
  net_salary decimal(15,2) [not null]
  
  // Employer contributions
  bhxh_employer decimal(15,2)
  bhyt_employer decimal(15,2)
  bhtn_employer decimal(15,2)
  total_insurance_employer decimal(15,2)
  
  created_at timestamp [default: `now()`]
  
  indexes {
    (payroll_period_id, employee_id) [unique]
  }
  
  Note: 'FR-PB-002 to FR-PB-017: Bang luong'
}

Table payroll_allowance_detail {
  id int [pk, increment]
  payroll_id int [ref: > payroll.id, not null]
  allowance_type_id int [ref: > cfg_allowance_type.id, not null]
  amount decimal(15,2) [not null]
  calculation_note text
  
  Note: 'Chi tiet phu cap trong bang luong'
}

Table payroll_deduction_detail {
  id int [pk, increment]
  payroll_id int [ref: > payroll.id, not null]
  deduction_type varchar(50) [not null]
  amount decimal(15,2) [not null]
  note text
  
  Note: 'Chi tiet khau tru'
}

Table advance_payment {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  amount decimal(15,2) [not null]
  request_date date [not null]
  reason text
  status varchar(20) [default: 'pending']
  approved_by int [ref: > employee.id]
  approved_at timestamp
  paid_at timestamp
  deducted_in_period_id int [ref: > payroll_period.id]
  
  Note: 'FR-PB-010: Tam ung'
}

Table bonus {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  bonus_type varchar(50) [not null, note: 'tet, holiday, performance, other']
  amount decimal(15,2) [not null]
  bonus_date date [not null]
  reason text
  decision_number varchar(100)
  payroll_period_id int [ref: > payroll_period.id]
  
  Note: 'FR-PB-015: Thuong'
}

// =============================================================================
// SECTION 8: RECRUITMENT (FR-RC)
// =============================================================================

Table job_posting {
  id int [pk, increment]
  title varchar(200) [not null]
  unit_id int [ref: > organization_unit.id, not null]
  position_id int [ref: > cfg_position.id]
  
  quantity int [not null, default: 1]
  job_description text
  requirements text
  benefits text
  salary_range varchar(100)
  
  posting_date date [not null]
  deadline date [not null]
  
  status varchar(20) [default: 'draft', note: 'draft, published, closed, filled']
  
  created_by int [ref: > employee.id]
  created_at timestamp [default: `now()`]
  
  Note: 'FR-RC-001, FR-RC-002: Thong bao tuyen dung'
}

Table candidate {
  id int [pk, increment]
  job_posting_id int [ref: > job_posting.id, not null]
  
  full_name varchar(100) [not null]
  email varchar(100) [not null]
  phone varchar(20)
  date_of_birth date
  gender varchar(10)
  address text
  
  resume_url varchar(500)
  cover_letter text
  
  current_company varchar(200)
  current_position varchar(100)
  years_of_experience int
  
  education_level varchar(50)
  major varchar(200)
  
  application_date timestamp [default: `now()`]
  source varchar(50) [note: 'website, referral, job_site']
  
  status varchar(20) [default: 'applied', note: 'applied, screening, interview, offered, hired, rejected']
  
  Note: 'FR-RC-003, FR-RC-004, FR-RC-008: Ung vien'
}

Table interview {
  id int [pk, increment]
  candidate_id int [ref: > candidate.id, not null]
  round int [not null, default: 1]
  interview_date timestamp [not null]
  location varchar(200)
  interview_type varchar(50) [note: 'in_person, online, phone']
  
  status varchar(20) [default: 'scheduled', note: 'scheduled, completed, cancelled, no_show']
  
  overall_score decimal(4,2)
  recommendation varchar(50) [note: 'pass, fail, consider']
  notes text
  
  created_by int [ref: > employee.id]
  
  Note: 'FR-RC-005, FR-RC-006: Phong van'
}

Table interview_panel {
  id int [pk, increment]
  interview_id int [ref: > interview.id, not null]
  interviewer_id int [ref: > employee.id, not null]
  role varchar(50) [note: 'lead, technical, hr']
  score decimal(4,2)
  feedback text
  
  Note: 'Hoi dong phong van'
}

Table job_offer {
  id int [pk, increment]
  candidate_id int [ref: > candidate.id, not null]
  offer_date date [not null]
  position varchar(200) [not null]
  unit_id int [ref: > organization_unit.id, not null]
  
  proposed_salary decimal(15,2)
  proposed_rank_id int [ref: > cfg_salary_rank.id]
  proposed_grade int
  
  start_date date
  response_deadline date
  
  status varchar(20) [default: 'pending', note: 'pending, accepted, declined, expired']
  response_date date
  
  created_by int [ref: > employee.id]
  
  Note: 'FR-RC-007, FR-RC-009: De xuat tuyen dung'
}

// =============================================================================
// SECTION 9: PERFORMANCE & REWARDS (FR-PR)
// =============================================================================

Table evaluation_period {
  id int [pk, increment]
  name varchar(100) [not null]
  year int [not null]
  start_date date [not null]
  end_date date [not null]
  evaluation_deadline date
  status varchar(20) [default: 'draft']
  
  Note: 'Ky danh gia'
}

Table evaluation_criteria {
  id int [pk, increment]
  name varchar(200) [not null]
  description text
  weight decimal(5,2) [note: 'Trong so %']
  category varchar(50) [note: 'teaching, research, service, other']
  applies_to varchar(50) [note: 'lecturer, staff, all']
  is_active boolean [default: true]
  
  Note: 'Tieu chi danh gia'
}

Table employee_evaluation {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  period_id int [ref: > evaluation_period.id, not null]
  
  self_evaluation_date timestamp
  self_evaluation_notes text
  
  manager_id int [ref: > employee.id]
  manager_evaluation_date timestamp
  manager_notes text
  
  final_score decimal(5,2)
  final_rating varchar(50) [note: 'excellent, good, satisfactory, unsatisfactory']
  
  unit_head_approval_date timestamp
  hr_approval_date timestamp
  rector_approval_date timestamp
  
  status varchar(20) [default: 'pending']
  
  indexes {
    (employee_id, period_id) [unique]
  }
  
  Note: 'FR-PR-001 to FR-PR-004: Danh gia vien chuc'
}

Table evaluation_score {
  id int [pk, increment]
  evaluation_id int [ref: > employee_evaluation.id, not null]
  criteria_id int [ref: > evaluation_criteria.id, not null]
  self_score decimal(5,2)
  manager_score decimal(5,2)
  final_score decimal(5,2)
  note text
  
  Note: 'Diem theo tieu chi'
}

Table reward_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  level varchar(50) [note: 'university, ministry, state']
  is_active boolean [default: true]
  
  Note: 'Loai khen thuong'
}

Table employee_reward {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  reward_type_id int [ref: > reward_type.id, not null]
  reward_date date [not null]
  year int [not null]
  decision_number varchar(100)
  decision_date date
  reason text
  bonus_amount decimal(15,2)
  
  Note: 'FR-PR-005, FR-PR-007, FR-PR-009: Khen thuong'
}

Table discipline_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  severity int [note: '1=Khien trach, 4=Buoc thoi viec']
  is_active boolean [default: true]
  
  Note: 'Hinh thuc ky luat'
}

Table employee_discipline {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  discipline_type_id int [ref: > discipline_type.id, not null]
  violation_date date
  discipline_date date [not null]
  decision_number varchar(100)
  decision_date date
  reason text
  duration_months int [note: 'Thoi han ky luat']
  end_date date
  salary_impact decimal(15,2) [note: 'Anh huong luong']
  
  Note: 'FR-PR-006, FR-PR-007: Ky luat'
}

Table emulation_title {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  level varchar(50)
  is_active boolean [default: true]
  
  Note: 'Danh hieu thi dua'
}

Table employee_emulation {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  title_id int [ref: > emulation_title.id, not null]
  year int [not null]
  decision_number varchar(100)
  decision_date date
  
  Note: 'FR-PR-009: Danh hieu thi dua theo nam'
}

// =============================================================================
// SECTION 10: TRAINING & DEVELOPMENT (FR-TD)
// =============================================================================

Table training_program_internal {
  id int [pk, increment]
  name varchar(200) [not null]
  description text
  training_type varchar(50) [not null, note: 'short_course, workshop, conference, degree']
  location_type varchar(20) [not null, note: 'domestic, international']
  institution_id int [ref: > institution.id]
  start_date date
  end_date date
  budget decimal(15,2)
  status varchar(20) [default: 'planned']
  
  Note: 'FR-TD-001, FR-TD-002: Chuong trinh dao tao'
}

Table training_enrollment {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  training_program_id int [ref: > training_program_internal.id, not null]
  
  enrollment_date date [not null]
  expected_completion_date date
  actual_completion_date date
  
  status varchar(20) [default: 'enrolled', note: 'enrolled, in_progress, completed, withdrawn']
  result varchar(50)
  certificate_received boolean [default: false]
  
  // For degree programs (FR-TD-003)
  degree_type varchar(50) [note: 'master, doctoral']
  thesis_title varchar(500)
  supervisor varchar(200)
  
  // Commitment (FR-TD-004)
  has_commitment boolean [default: false]
  commitment_years int
  commitment_end_date date
  
  // Cost tracking (FR-TD-006)
  tuition_fee decimal(15,2)
  travel_cost decimal(15,2)
  other_costs decimal(15,2)
  paid_by_university boolean [default: true]
  
  Note: 'FR-TD-003, FR-TD-004, FR-TD-005: Cu di hoc'
}

Table training_certificate_earned {
  id int [pk, increment]
  enrollment_id int [ref: > training_enrollment.id, not null]
  certificate_type_id int [ref: > certificate_type.id]
  certificate_name varchar(200) [not null]
  issue_date date
  certificate_number varchar(100)
  
  Note: 'FR-TD-008: Chung chi sau dao tao'
}

// =============================================================================
// SECTION 11: RESEARCH MANAGEMENT (FR-RM)
// =============================================================================

Table research_project_level {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  is_active boolean [default: true]
  
  Note: 'Cap de tai (truong, bo, nha nuoc)'
}

Table research_project {
  id int [pk, increment]
  code varchar(50) [not null, unique]
  title varchar(500) [not null]
  level_id int [ref: > research_project_level.id, not null]
  
  principal_investigator_id int [ref: > employee.id, not null]
  unit_id int [ref: > organization_unit.id]
  
  start_date date
  end_date date
  budget decimal(15,2)
  funding_source varchar(200)
  
  status varchar(20) [default: 'proposed', note: 'proposed, approved, in_progress, completed, cancelled']
  
  abstract text
  
  Note: 'FR-RM-001: De tai NCKH'
}

Table research_project_member {
  id int [pk, increment]
  project_id int [ref: > research_project.id, not null]
  employee_id int [ref: > employee.id, not null]
  role varchar(50) [not null, note: 'PI, Co-PI, researcher, assistant']
  join_date date
  leave_date date
  research_hours int [note: 'Gio NCKH quy doi']
  
  Note: 'Thanh vien de tai'
}

Table publication_type {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(100) [not null]
  research_hours int [note: 'Gio quy doi']
  is_active boolean [default: true]
  
  Note: 'Loai cong bo (bao ISI, Scopus, trong nuoc, sach, patent...)'
}

Table publication {
  id int [pk, increment]
  title varchar(500) [not null]
  publication_type_id int [ref: > publication_type.id, not null]
  
  journal_name varchar(300)
  conference_name varchar(300)
  publisher varchar(200)
  
  publication_date date
  volume varchar(50)
  issue varchar(50)
  pages varchar(50)
  doi varchar(200)
  isbn varchar(50)
  issn varchar(50)
  
  is_isi boolean [default: false]
  is_scopus boolean [default: false]
  impact_factor decimal(6,3)
  
  abstract text
  keywords text
  
  Note: 'FR-RM-002: Cong bo khoa hoc'
}

Table publication_author {
  id int [pk, increment]
  publication_id int [ref: > publication.id, not null]
  employee_id int [ref: > employee.id]
  author_name varchar(200) [not null]
  author_order int [not null]
  is_corresponding boolean [default: false]
  affiliation varchar(300)
  research_hours int
  
  Note: 'Tac gia cong bo'
}

Table thesis_supervision {
  id int [pk, increment]
  supervisor_id int [ref: > employee.id, not null]
  student_name varchar(100) [not null]
  student_id varchar(50)
  
  thesis_type varchar(20) [not null, note: 'doctoral, master, undergraduate']
  thesis_title varchar(500) [not null]
  
  start_date date
  expected_end_date date
  defense_date date
  
  status varchar(20) [default: 'in_progress']
  result varchar(50)
  
  supervision_hours int [note: 'Gio quy doi huong dan']
  
  Note: 'FR-RM-004: Huong dan NCS, hoc vien'
}

// =============================================================================
// SECTION 12: TEACHING LOAD (FR-TL)
// =============================================================================

Table academic_year {
  id int [pk, increment]
  name varchar(50) [not null, unique, note: '2024-2025']
  start_date date [not null]
  end_date date [not null]
  is_current boolean [default: false]
  
  Note: 'Nam hoc'
}

Table semester {
  id int [pk, increment]
  academic_year_id int [ref: > academic_year.id, not null]
  semester_number int [not null, note: '1, 2, 3 (he)']
  name varchar(50)
  start_date date [not null]
  end_date date [not null]
  
  indexes {
    (academic_year_id, semester_number) [unique]
  }
  
  Note: 'Hoc ky'
}

Table course {
  id int [pk, increment]
  code varchar(20) [not null, unique]
  name varchar(200) [not null]
  credits int [not null]
  theory_hours int
  practice_hours int
  unit_id int [ref: > organization_unit.id]
  is_active boolean [default: true]
  
  Note: 'Mon hoc'
}

Table teaching_assignment {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  semester_id int [ref: > semester.id, not null]
  course_id int [ref: > course.id, not null]
  
  class_code varchar(50)
  student_count int
  
  theory_hours int [default: 0]
  practice_hours int [default: 0]
  
  // Converted to standard hours
  standard_hours decimal(6,2) [note: 'Gio quy doi theo he so']
  
  status varchar(20) [default: 'assigned']
  
  Note: 'FR-TL-002, FR-TL-003: Phan cong giang day'
}

Table teaching_load_summary {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  academic_year_id int [ref: > academic_year.id, not null]
  
  // Quota from config
  quota_hours int [not null, note: 'Dinh muc (FR-CF-027)']
  
  // Teaching hours
  total_teaching_hours decimal(8,2) [default: 0]
  
  // Other activities converted to hours
  thesis_supervision_hours decimal(8,2) [default: 0]
  research_hours decimal(8,2) [default: 0]
  exam_hours decimal(8,2) [default: 0]
  other_hours decimal(8,2) [default: 0]
  
  // Total and excess
  total_standard_hours decimal(8,2)
  excess_hours decimal(8,2) [note: 'Gio vuot dinh muc']
  
  // Linked to payroll
  excess_payment decimal(15,2)
  payment_period_id int [ref: > payroll_period.id]
  
  indexes {
    (employee_id, academic_year_id) [unique]
  }
  
  Note: 'FR-TL-001, FR-TL-004, FR-TL-005, FR-TL-007: Tong hop gio giang'
}

Table teaching_other_activity {
  id int [pk, increment]
  employee_id int [ref: > employee.id, not null]
  academic_year_id int [ref: > academic_year.id, not null]
  
  activity_type varchar(50) [not null, note: 'thesis_review, exam_creation, exam_grading, committee...']
  description text
  quantity int [default: 1]
  conversion_rate decimal(4,2) [note: 'From cfg_teaching_conversion']
  standard_hours decimal(6,2)
  
  Note: 'FR-TL-005: Hoat dong khac quy doi gio'
}

// =============================================================================
// SECTION 13: SYSTEM & AUDIT
// =============================================================================

Table system_user {
  id int [pk, increment]
  employee_id int [ref: > employee.id, unique]
  username varchar(50) [not null, unique]
  password_hash varchar(255) [not null]
  email varchar(100)
  
  is_active boolean [default: true]
  last_login timestamp
  password_changed_at timestamp
  failed_login_attempts int [default: 0]
  locked_until timestamp
  
  created_at timestamp [default: `now()`]
  
  Note: 'Tai khoan he thong'
}

Table role {
  id int [pk, increment]
  code varchar(50) [not null, unique]
  name varchar(100) [not null]
  description text
  is_system boolean [default: false]
  is_active boolean [default: true]
  
  Note: 'Vai tro (Admin, HR, Finance, Unit Head, Employee...)'
}

Table user_role {
  id int [pk, increment]
  user_id int [ref: > system_user.id, not null]
  role_id int [ref: > role.id, not null]
  unit_id int [ref: > organization_unit.id, note: 'Pham vi don vi (null = toan truong)']
  assigned_at timestamp [default: `now()`]
  assigned_by int [ref: > system_user.id]
  
  indexes {
    (user_id, role_id, unit_id) [unique]
  }
  
  Note: 'Gan vai tro cho user'
}

Table permission {
  id int [pk, increment]
  code varchar(100) [not null, unique]
  name varchar(200) [not null]
  module varchar(50)
  action varchar(50) [note: 'create, read, update, delete, approve']
  
  Note: 'Quyen han'
}

Table role_permission {
  id int [pk, increment]
  role_id int [ref: > role.id, not null]
  permission_id int [ref: > permission.id, not null]
  
  indexes {
    (role_id, permission_id) [unique]
  }
  
  Note: 'Quyen theo vai tro'
}

Table audit_log {
  id int [pk, increment]
  user_id int [ref: > system_user.id]
  action varchar(50) [not null]
  table_name varchar(100)
  record_id int
  old_values text [note: 'JSON']
  new_values text [note: 'JSON']
  ip_address varchar(50)
  user_agent text
  created_at timestamp [default: `now()`]
  
  Note: 'Nhat ky he thong'
}

Table notification {
  id int [pk, increment]
  recipient_id int [ref: > system_user.id, not null]
  sender_id int [ref: > system_user.id]
  
  title varchar(200) [not null]
  content text
  link varchar(500)
  
  notification_type varchar(50)
  is_read boolean [default: false]
  read_at timestamp
  
  created_at timestamp [default: `now()`]
  
  Note: 'Thong bao'
}

Table config_change_log {
  id int [pk, increment]
  config_table varchar(100) [not null]
  config_id int [not null]
  field_name varchar(100)
  old_value text
  new_value text
  changed_by int [ref: > system_user.id]
  changed_at timestamp [default: `now()`]
  approval_status varchar(20) [default: 'pending']
  approved_by int [ref: > system_user.id]
  approved_at timestamp
  
  Note: 'FR-CF-032, FR-CF-033: Lich su thay doi cau hinh'
}
