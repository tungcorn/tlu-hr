# Payroll Calculation Wizard

## Screen Metadata

| Item       | Detail                                         |
| ---------- | ---------------------------------------------- |
| Screen ID  | PB-WIZARD-001                                  |
| Module     | Payroll & Benefits (FR-PB)                     |
| Related FR | FR-PB-001 to FR-PB-016, FR-CF-001 to FR-CF-021 |

---

# Wizard Tính Lương Hàng Tháng - Monthly Salary Calculation

**User Goal:** Execute the monthly payroll calculation process with full visibility, validation, exception handling, and bank export generation.

**Role:** Finance Staff (Phòng TCKT), Finance Manager

---

## Wizard Overview

```
+------------------------------------------------------------------+
| TÍNH LƯƠNG THÁNG                                                  |
+------------------------------------------------------------------+
|                                                                   |
|  +------+     +------+     +------+     +------+                  |
|  |  1   |---->|  2   |---->|  3   |---->|  4   |                  |
|  | Tổng |     | Kiểm |     | Xử lý|     | Hoàn |                  |
|  | hợp  |     | tra  |     | Ngoại|     | tất  |                  |
|  | DL   |     | TS   |     | lệ   |     |      |                  |
|  +------+     +------+     +------+     +------+                  |
|  [ACTIVE]     [Pending]    [Pending]    [Pending]                 |
|                                                                   |
+------------------------------------------------------------------+
```

### Step Flow

| Step | Name                  | Description                    | Gate Condition             |
| ---- | --------------------- | ------------------------------ | -------------------------- |
| 1    | Data Aggregation      | Collect timekeeping + workload | All data sources available |
| 2    | Parameter Check       | Verify salary coefficients     | No missing parameters      |
| 3    | Variance & Exceptions | Review anomalies               | All exceptions resolved    |
| 4    | Finalize & Export     | Approve and generate bank file | Manager approval           |

---

## Step 1: Data Aggregation (Tổng hợp Dữ liệu)

```
+------------------------------------------------------------------+
|  [Sidebar]  |  Tính lương > Wizard > Bước 1: Tổng hợp Dữ liệu     |
|             |  Tháng: 01/2026                         [Hủy] [Tiếp]|
+-------------|----------------------------------------------------+
|             |                                                     |
|  WIZARD     |  +------------------------------------------------+|
|  PROGRESS   |  | CHỌN KỲ TÍNH LƯƠNG                              ||
|             |  +------------------------------------------------+|
|  [1]        |  | Tháng:  [01 v]  Năm: [2026 v]                   ||
|  Tổng hợp   |  | Kỳ tính: 01/01/2026 - 31/01/2026                ||
|   (Active)  |  | Số ngày làm việc: 22 ngày                       ||
|             |  +------------------------------------------------+|
|  [ ]        |                                                     |
|  Kiểm tra   |  +------------------------------------------------+|
|             |  | NGUỒN DỮ LIỆU                                   ||
|  [ ]        |  +------------------------------------------------+|
|  Xử lý NL   |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|  [ ]        |  | | [Check] CHẤM CÔNG                          | ||
|  Hoàn tất   |  | |                                            | ||
|             |  | | Trạng thái: [GREEN] Sẵn sàng                | ||
|             |  | | Nguồn: Hệ thống chấm công (Máy ZKT)        | ||
|             |  | | Cập nhật: 01/02/2026 08:00                 | ||
|             |  | | Số nhân sự: 1,203 người                    | ||
|             |  | | Số ngày công: 26,466 ngày                  | ||
|             |  | |                                            | ||
|             |  | | [Xem chi tiết] [Đồng bộ lại]               | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | | [Check] GIỜ GIẢNG                          | ||
|             |  | |                                            | ||
|             |  | | Trạng thái: [YELLOW] Cần xác nhận          | ||
|             |  | | Nguồn: Module Giờ giảng (FR-TL)            | ||
|             |  | | Kỳ: Học kỳ 1, 2025-2026                    | ||
|             |  | | Số GV: 738 người                           | ||
|             |  | | Tổng giờ chuẩn: 178,450 giờ                | ||
|             |  | |                                            | ||
|             |  | | [!] 12 GV chưa được xác nhận               | ||
|             |  | | [Xem chi tiết] [Xác nhận tất cả]           | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | | [Check] DỮ LIỆU LƯƠNG CƠ BẢN               | ||
|             |  | |                                            | ||
|             |  | | Trạng thái: [GREEN] Sẵn sàng                | ||
|             |  | | Nguồn: Hồ sơ nhân sự (FR-ER, FR-QM)        | ||
|             |  | | Số nhân sự có bảng lương: 1,203            | ||
|             |  | |                                            | ||
|             |  | | [Xem chi tiết]                             | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | HÀNH ĐỘNG                                       ||
|             |  +------------------------------------------------+|
|             |  | [Quay lại]           [TỔNG HỢP VÀ TIẾP TỤC ->] ||
|             |  +------------------------------------------------+|
|             |                                                     |
+------------------------------------------------------------------+
```

### Data Source Status Indicators

| Status       | Color  | Icon      | Meaning                       |
| ------------ | ------ | --------- | ----------------------------- |
| Sẵn sàng     | Green  | Checkmark | Data is complete and verified |
| Cần xác nhận | Yellow | Warning   | Needs manual confirmation     |
| Lỗi          | Red    | X         | Data missing or corrupted     |
| Đang tải     | Blue   | Spinner   | Loading data                  |

---

## Step 2: Parameter Check (Kiểm tra Tham số)

```
+------------------------------------------------------------------+
|  [Sidebar]  |  Tính lương > Wizard > Bước 2: Kiểm tra Tham số     |
|             |  Tháng: 01/2026                     [Quay lại] [Tiếp]|
+-------------|----------------------------------------------------+
|             |                                                     |
|  WIZARD     |  +------------------------------------------------+|
|  PROGRESS   |  | THAM SỐ LƯƠNG ÁP DỤNG                           ||
|             |  +------------------------------------------------+|
|  [Done]     |  |                                                 ||
|  Tổng hợp   |  | Mức lương cơ sở:                                ||
|             |  | +--------------------------------------------+ ||
|  [2]        |  | | Giá trị: 2,340,000 VNĐ                     | ||
|  Kiểm tra   |  | | Hiệu lực từ: 01/07/2024                    | ||
|   (Active)  |  | | Căn cứ: Nghị định 73/2024/NĐ-CP            | ||
|             |  | | Trạng thái: [GREEN] Hợp lệ                 | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|  [ ]        |  | Tỷ lệ Bảo hiểm:                                 ||
|  Xử lý NL   |  | +--------------------------------------------+ ||
|             |  | | BHXH (NLĐ): 8%    | BHXH (NSDLĐ): 17.5%    | ||
|  [ ]        |  | | BHYT (NLĐ): 1.5%  | BHYT (NSDLĐ): 3%       | ||
|  Hoàn tất   |  | | BHTN (NLĐ): 1%    | BHTN (NSDLĐ): 1%       | ||
|             |  | | Hiệu lực từ: 01/01/2024                    | ||
|             |  | | Trạng thái: [GREEN] Hợp lệ                 | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | HỆ SỐ LƯƠNG NHÂN SỰ                             ||
|             |  +------------------------------------------------+|
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | | Tổng số nhân sự:      1,203                | ||
|             |  | | Có hệ số hợp lệ:      1,198 [GREEN]        | ||
|             |  | | Thiếu hệ số:          5 [RED]              | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  | [!] 5 nhân sự thiếu thông tin hệ số lương:     ||
|             |  | +--------------------------------------------+ ||
|             |  | | # | Tên           | Mã CB    | Vấn đề      | ||
|             |  | |---|---------------|----------|-------------| ||
|             |  | | 1 | Nguyen Van X  | TLU-2025 | Chưa có ngạch||
|             |  | | 2 | Tran Thi Y    | TLU-2025 | Chưa có bậc | ||
|             |  | | 3 | Le Van Z      | TLU-2025 | Hệ số null  | ||
|             |  | | 4 | ...           | ...      | ...         | ||
|             |  | +--------------------------------------------+ ||
|             |  | [Xử lý từng trường hợp] [Loại khỏi kỳ tính]    ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | PHỤ CẤP ĐẶC BIỆT                                ||
|             |  +------------------------------------------------+|
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | | Phụ cấp mới trong kỳ:                      | ||
|             |  | | - 3 người được bổ nhiệm chức vụ mới        | ||
|             |  | | - 15 người tăng bậc thâm niên              | ||
|             |  | |                                            | ||
|             |  | | [Xem chi tiết thay đổi]                    | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | [QUAY LẠI]        [KIỂM TRA VÀ TIẾP TỤC ->]    ||
|             |  +------------------------------------------------+|
|             |                                                     |
+------------------------------------------------------------------+
```

### Parameter Validation Rules

| Parameter       | Validation                     | Blocking    |
| --------------- | ------------------------------ | ----------- |
| Mức lương cơ sở | Must have valid effective date | Yes         |
| Tỷ lệ bảo hiểm  | Must be > 0 and < 100          | Yes         |
| Hệ số lương     | All employees must have        | Can exclude |
| Ngạch bậc       | Must match employee's ngach    | Yes         |

---

## Step 3: Variance Report & Exception Handling (Xử lý Ngoại lệ)

```
+------------------------------------------------------------------+
|  [Sidebar]  |  Tính lương > Wizard > Bước 3: Xử lý Ngoại lệ       |
|             |  Tháng: 01/2026                     [Quay lại] [Tiếp]|
+-------------|----------------------------------------------------+
|             |                                                     |
|  WIZARD     |  +------------------------------------------------+|
|  PROGRESS   |  | TỔNG QUAN KẾT QUẢ TÍNH TOÁN                     ||
|             |  +------------------------------------------------+|
|  [Done]     |  |                                                 ||
|  Tổng hợp   |  | +-----------+ +-----------+ +---------------+  ||
|             |  | | TỔNG QUỸ  | | TỔNG LƯƠNG| | CHÊNH LỆCH    |  ||
|  [Done]     |  | | LƯƠNG     | | THÁNG NÀY | | VS THÁNG TRƯỚC|  ||
|  Kiểm tra   |  | |           | |           | |               |  ||
|             |  | | 15.2 tỷ   | | 15.8 tỷ   | | +4.2%         |  ||
|  [3]        |  | +-----------+ +-----------+ +---------------+  ||
|  Xử lý NL   |  |                                                 ||
|   (Active)  |  +------------------------------------------------+|
|             |                                                     |
|  [ ]        |  +------------------------------------------------+|
|  Hoàn tất   |  | BÁO CÁO CHÊNH LỆCH (VARIANCE REPORT)            ||
|             |  +------------------------------------------------+|
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | | [!] 23 trường hợp cần xem xét              | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  | Phân loại ngoại lệ:                             ||
|             |  | +--------------------------------------------+ ||
|             |  | | [RED] Chênh lệch > 20%:           3        | ||
|             |  | | [YELLOW] Chênh lệch 10-20%:       8        | ||
|             |  | | [BLUE] Trường hợp đặc biệt:       12       | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | DANH SÁCH NGOẠI LỆ CẦN XỬ LÝ                    ||
|             |  +------------------------------------------------+|
|             |  |                                                 ||
|             |  | Filter: [Tất cả v] [Chưa xử lý v] [Tìm kiếm...] ||
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | |TT| Tên         | Chênh lệch | Lý do   |XL  | ||
|             |  | |--|-------------|------------|---------|----| ||
|             |  | |[R]| Pham Van D | +45%       | Thưởng  |[ ] | ||
|             |  | |   |            | +5.2tr     | tết     |    | ||
|             |  | |---|-------------|------------|---------|----| ||
|             |  | |[R]| Hoang E    | -35%       | Nghỉ    |[x] | ||
|             |  | |   |            | -4.1tr     | không   |    | ||
|             |  | |   |            |            | lương   |    | ||
|             |  | |---|-------------|------------|---------|----| ||
|             |  | |[Y]| Nguyen F   | +15%       | Nâng    |[ ] | ||
|             |  | |   |            | +2.1tr     | bậc     |    | ||
|             |  | |---|-------------|------------|---------|----| ||
|             |  | |[B]| Le G       | 0%         | Mới     |[ ] | ||
|             |  | |   |            | (New)      | tuyển   |    | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  | [Xác nhận tất cả] [Xuất báo cáo ngoại lệ]       ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | [QUAY LẠI]    [XÁC NHẬN NGOẠI LỆ VÀ TIẾP TỤC ->]||
|             |  +------------------------------------------------+|
|             |                                                     |
+------------------------------------------------------------------+
```

### Exception Detail Modal

```
+------------------------------------------------------------------+
| CHI TIẾT NGOẠI LỆ                                          [X]   |
+------------------------------------------------------------------+
|                                                                   |
|  Nhân sự: Pham Van D (TLU-2018-0456)                              |
|  Đơn vị: Khoa Công nghệ Thông tin                                 |
|                                                                   |
|  +-------------------------------+-------------------------------+|
|  | THÁNG NÀY (01/2026)           | THÁNG TRƯỚC (12/2025)        ||
|  +-------------------------------+-------------------------------+|
|  | Lương cơ bản:    12,682,800   | Lương cơ bản:    12,682,800  ||
|  | Phụ cấp:          5,648,292   | Phụ cấp:          5,648,292  ||
|  | Thưởng:           6,000,000   | Thưởng:                   0  ||
|  | Trừ BH+Thuế:     -2,196,694   | Trừ BH+Thuế:     -2,196,694  ||
|  +-------------------------------+-------------------------------+|
|  | TỔNG:            22,134,398   | TỔNG:            16,134,398  ||
|  +-------------------------------+-------------------------------+|
|  | CHÊNH LỆCH:      +6,000,000 (+37.2%)                          ||
|  +--------------------------------------------------------------+|
|                                                                   |
|  Nguyên nhân phát hiện:                                           |
|  [!] Chênh lệch > 20% so với tháng trước                          |
|                                                                   |
|  Giải thích:                                                      |
|  +----------------------------------------------------------+    |
|  | Thưởng Tết Nguyên đán 2026 theo QĐ số 123/QĐ-ĐHTL        |    |
|  +----------------------------------------------------------+    |
|                                                                   |
|  [HỦY BỎ]                    [XÁC NHẬN HỢP LỆ] [YÊU CẦU ĐIỀU CHỈNH]|
+------------------------------------------------------------------+
```

---

## Step 4: Finalize & Bank Export (Hoàn tất và Xuất file)

```
+------------------------------------------------------------------+
|  [Sidebar]  |  Tính lương > Wizard > Bước 4: Hoàn tất             |
|             |  Tháng: 01/2026                   [Quay lại] [Xong]  |
+-------------|----------------------------------------------------+
|             |                                                     |
|  WIZARD     |  +------------------------------------------------+|
|  PROGRESS   |  | TÓM TẮT KỲ TÍNH LƯƠNG                           ||
|             |  +------------------------------------------------+|
|  [Done]     |  |                                                 ||
|  Tổng hợp   |  | Kỳ tính lương:    Tháng 01/2026                 ||
|             |  | Số nhân sự:       1,198 người (loại 5 thiếu DL) ||
|  [Done]     |  | Tổng quỹ lương:   15,847,234,500 VNĐ            ||
|  Kiểm tra   |  | Người tạo:        Nguyen Thi H (TCKT)           ||
|             |  | Thời gian:        02/02/2026 14:30              ||
|  [Done]     |  |                                                 ||
|  Xử lý NL   |  +------------------------------------------------+|
|             |                                                     |
|  [4]        |  +------------------------------------------------+|
|  Hoàn tất   |  | PHÊ DUYỆT                                       ||
|   (Active)  |  +------------------------------------------------+|
|             |  |                                                 ||
|             |  | Quy trình phê duyệt:                            ||
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | | [DONE] Nhân viên TCKT tạo bảng lương       | ||
|             |  | |        Nguyen Thi H - 02/02/2026 14:30     | ||
|             |  | +--------------------------------------------+ ||
|             |  | | [WAIT] Kế toán trưởng duyệt                | ||
|             |  | |        Đang chờ...                         | ||
|             |  | |        [GỬI YÊU CẦU PHÊ DUYỆT]              | ||
|             |  | +--------------------------------------------+ ||
|             |  | | [LOCK] Hiệu trưởng duyệt                   | ||
|             |  | |        Chờ kế toán trưởng duyệt trước      | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | XUẤT FILE                                       ||
|             |  +------------------------------------------------+|
|             |  |                                                 ||
|             |  | +--------------------------------------------+ ||
|             |  | | [Excel] Bảng lương chi tiết                | ||
|             |  | |         [TẢI XUỐNG]                        | ||
|             |  | +--------------------------------------------+ ||
|             |  | | [Excel] Bảng tổng hợp theo đơn vị          | ||
|             |  | |         [TẢI XUỐNG]                        | ||
|             |  | +--------------------------------------------+ ||
|             |  | | [Bank] File chuyển khoản Vietcombank       | ||
|             |  | |        [TẢI XUỐNG] (cần phê duyệt HT)      | ||
|             |  | +--------------------------------------------+ ||
|             |  | | [PDF] Phiếu lương cá nhân                  | ||
|             |  | |       [GỬI EMAIL TẤT CẢ] [TẢI ZIP]         | ||
|             |  | +--------------------------------------------+ ||
|             |  |                                                 ||
|             |  +------------------------------------------------+|
|             |                                                     |
|             |  +------------------------------------------------+|
|             |  | [LƯU NHÁP]  [QUAY LẠI]         [HOÀN TẤT TÍNH]  ||
|             |  +------------------------------------------------+|
|             |                                                     |
+------------------------------------------------------------------+
```

### Bank File Format Options

```
+------------------------------------------------------------------+
| XUẤT FILE NGÂN HÀNG                                        [X]   |
+------------------------------------------------------------------+
|                                                                   |
|  Chọn ngân hàng:                                                  |
|  +----------------------------------------------------------+    |
|  | (*) Vietcombank - File VCB Standard                      |    |
|  | ( ) BIDV - File BIDV Format                              |    |
|  | ( ) Vietinbank - File CTG Format                         |    |
|  | ( ) Techcombank - File TCB Format                        |    |
|  +----------------------------------------------------------+    |
|                                                                   |
|  Loại file:                                                       |
|  +----------------------------------------------------------+    |
|  | (*) Excel (.xlsx)                                        |    |
|  | ( ) CSV (.csv)                                           |    |
|  | ( ) XML (.xml)                                           |    |
|  +----------------------------------------------------------+    |
|                                                                   |
|  Thông tin file:                                                  |
|  +----------------------------------------------------------+    |
|  | Số lượng người hưởng:  1,198                             |    |
|  | Tổng số tiền:          14,523,456,789 VNĐ                |    |
|  | Ngày chi trả:          05/02/2026                        |    |
|  +----------------------------------------------------------+    |
|                                                                   |
|  [HỦY BỎ]                                        [TẠO FILE]       |
+------------------------------------------------------------------+
```

---

## Wizard Navigation Rules

### Step Transition Conditions

| From   | To       | Condition                     |
| ------ | -------- | ----------------------------- |
| Step 1 | Step 2   | All data sources green/yellow |
| Step 2 | Step 3   | No blocking parameter errors  |
| Step 3 | Step 4   | All exceptions acknowledged   |
| Step 4 | Complete | Required approvals obtained   |

### Wizard State Persistence

| Action            | Result                        |
| ----------------- | ----------------------------- |
| Close browser     | State saved, resume on return |
| "Luu nhap"        | Save current state as draft   |
| "Hoan tat"        | Lock payroll, prevent changes |
| Approval rejected | Unlock for editing            |

---

## Keyboard Shortcuts

| Key         | Action                          |
| ----------- | ------------------------------- |
| Alt+1/2/3/4 | Jump to step                    |
| Ctrl+S      | Save current state              |
| Enter       | Proceed to next step (if valid) |
| Escape      | Cancel current modal            |

---

## Responsive Behavior

### Desktop (> 1024px)

- Full wizard with sidebar progress
- Side-by-side comparison tables
- Inline exception handling

### Tablet (768px - 1024px)

- Collapsed wizard progress (top bar)
- Stacked comparison tables
- Modal exception handling

### Mobile (< 768px)

- Step indicator as dots
- Card-based data display
- Full-screen modals for all actions
